# 第一章 跑马灯实验

## 1. 导入

任何一个单片机， 最简单的外设莫过于 IO 口的高低电平控制了，本章将通过一个经典的跑马灯程序，带大家开启 STM32F4 之旅， 通过本章的学习， 你将了解到 STM32F4 的 IO 口作为输出使用的方法。 在本章中， 我们将通过代码控制 ALIENTEK 探索者 STM32F4 开发板上的两个 LED： DS0 和 DS1 交替闪烁，实现类似跑马灯的效果。

## 2. STM32F4 IO简介

首先要提一下，在 HAL 库中， GPIO 端口操作对应的 HAL 库函数函数以及相关定义在文件 stm32f4xx_hal_gpio.h 和 stm32f4xx_hal_gpio.c 中。

相对于 STM32F1 来说， STM32F4 的 GPIO 设置显得更为复杂，也更加灵活，尤其是复用功能部分，比 STM32F1 改进了很多，使用起来更加方便。

STM32F4 每组通用 I/O 端口包括 4 个 32 位配置寄存器（MODER、 OTYPER、 OSPEEDR和 PUPDR）、 2 个 32 位数据寄存器（IDR 和 ODR）、 1 个 32 位置位/复位寄存器 (BSRR)、1 个 32 位锁定寄存器 (LCKR) 和 2 个 32 位复用功能选择寄存器（AFRH 和 AFRL）等。

这样， STM32F4 每组 IO 有 10 个 32 位寄存器控制，其中常用的有 4 个配置寄存器+2 个数据寄存器+2 个复用功能选择寄存器，共 8 个，如果在使用的时候，每次都直接操作寄存器配置IO， 代码会比较多，也不容易记住，所以我们在讲解寄存器的同时会讲解使用 HAL 库函数配置 IO 的方法。

同 STM32F1 一样， STM32F4 的 IO 可以由软件配置成如下 8 种模式中的任何一种：

- 输入浮空

- 输入上拉

- 输入下拉

- 模拟输入

- 开漏输出

- 推挽输出

- 推挽式复用功能

- 开漏式复用功能

接下来我们详细介绍 IO 配置常用的 8 个寄存器： MODER、 OTYPER、 OSPEEDR、 PUPDR、 ODR、 IDR 、 AFRH 和 AFRL。同时讲解对应的库函数配置方法。

首先看 MODER 寄存器，该寄存器是 GPIO 端口模式控制寄存器，用于控制 GPIOx （STM32F4 最多有 9 组 IO，分别用大写字母表示，即 x=A/B/C/D/E/F/G/H/I，下同）的工作模式：


